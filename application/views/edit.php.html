<?php

  $privateID = $matches[1];
  $test = getTestByPrivateID($privateID);
  $publicID = getPublicIDByPrivateID($privateID);

  $stylesheet = "edit";
  include("views/header.php.html");
  if (empty($test)) { ?>
    <div id="feltest">
	  <p>Testet du angett finns inte.<br>
	  Försök igen:</p>
	  <form id="testform" action="javascript:redirect();">
	  <input type="text" id="testnamn" size="5" pattern="[A-Za-z]{5}" title="Ange 5 st stora eller små bokstäver"  x-moz-errormessage="Ange 5 st stora eller små bokstäver"  maxlength="5" required>
	  <input type="submit" id="ok" value="OK">
	  </form>
	</div>
	<script> function redirect(){ window.location.href = "http://august.friskola.nu/redigera/"+document.getElementById("testnamn").value } </script>
<?php } 

 else { ?>
  <div id="bakgrund">
    <div id="bakgrund2">
	  <u>Redigera test</u><br>
	  <h1>Testets namn:</h1><br>
      <h2>Testets bilder:</h2>
	<input name="title" type="text" value="<?= $test['title'] ?>" id="title" size="14" /> 
	<div id="bilder"></div>
	<div id="add">
	<div id="file">
	  <form id="uppladdning" method="post" enctype="multipart/form-data" action="/laddaUppBild/<?= $privateID ?>">  
      <input name="picture" onchange="this.form.submit()" type="file" accept="image/*" id="fileinput"/>
	  </form>
  </div>
	</div>
	<div id="testid">
	  Privat ID för testskapare: <?= $privateID ?><br>
	  <a id="testLink" href="http://august.friskola.nu/testa/<?= $publicID ?>">Publikt ID för testare: <?= $publicID ?></a>
	  <input type="submit" value="Ändra det publika ID:et" id="andra">
	</div>
	</div>
  </div>
  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
  <script src="http://code.jquery.com/ui/1.10.0/jquery-ui.js"></script>
  <script>
 
  var bilder = [<?php $i = 1;foreach ($test['images'] as $image) { ?>
  {file: "http://august.friskola.nu/uploads/<?= $publicID ?>/<?= $image ?>", 
   num: "<?= $i-1 ?>",
   id: "bild<?= $i++ ?>"}<?= (count($test["images"]) >= $i ? "," : "") ?>
<?php } ?>];

  function updateTitle()
  {
    $.ajax({ url: "/uppdateraTitel/<?= $privateID ?>", 
	         type: "POST" , 
	         data: {"title": $('#title').val()},
	         success: function(){ $('#title').css("border-style","none") }
	  })
  }

  function swap(i)
  {
    $.ajax({ url: "/bytBild/<?= $privateID ?>/"+i+"/"+(i+1), 
             type: "GET",
             success: function()
			 { 
               $('#bild'+i).css('background-image', 'url('+bilder[(i+1)].file+')');
			   $('#bild'+(i+1)).css('background-image', 'url('+bilder[i].file+')');
			   temp = bilder[i];
			   bilder[i] = bilder[(i+1)];
			   bilder[i+1] = temp;
			 },
             error: function() { alert("Det gick dåligt!"); }
           })  
   }
   
   function taBortBild(i)
   {
     $.ajax({ url:    "/taBortBild/<?= $privateID ?>/"+i, 
              type:    "GET",
              success: function() 
			  { 
			    $('#bild'+i).css("background-image", "none");
                $('#trash'+i).remove();	
			    window.location.reload(true);
			  },
              error:   function() { alert("Det gick dåligt!"); }
            }
     	     ) 
   }
   
  function updatePublicID(namn)
  {
    $.ajax({ url: "/andraPubID/<?= $privateID ?>/"+namn, 
	         type: "GET" , 
	         success: function(){ $('#pubID').css({"border-style":"none", "text-decoration":"underline"})},
	         error:   function(){ alert("det gick dåligt");}
	  })
  }
  </script>
  <script src="/scripts/edit.js"></script>
  <?php } ?>
  </body>
</html>
